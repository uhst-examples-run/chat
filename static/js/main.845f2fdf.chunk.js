(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){e.exports=n(47)},32:function(e,t,n){},34:function(e,t,n){},36:function(e,t,n){},38:function(e,t,n){},40:function(e,t,n){},47:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),c=n(22),r=n.n(c),s=(n(32),n(6)),i=n(7),l=n(9),m=n(8),u=n(10),h=n(26),d=n(0),p=n(14),f=n(16),b=(n(34),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).componentDidMount=function(){n.input.focus()},n.handleFormSubmit=function(e){e.preventDefault(),n.props.onMessageSend(n.input.value),n.input.value=""},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("form",{className:"MessageForm",onSubmit:this.handleFormSubmit},o.a.createElement("div",{className:"input-container"},o.a.createElement("input",{type:"text",ref:function(t){return e.input=t},placeholder:"Enter your message..."})),o.a.createElement("div",{className:"button-container"},o.a.createElement("button",{type:"submit"},"Send")))}}]),t}(a.Component)),g=n(23),v=n.n(g),w=(n(36),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=v()("Message",{log:!this.props.author,me:this.props.me});return o.a.createElement("div",{className:e},"[".concat(this.props.timestamp.getHours(),":").concat(this.props.timestamp.getMinutes(),"] "),this.props.author&&o.a.createElement("span",{className:"author"},"<",this.props.author,">"),this.props.body)}}]),t}(a.Component)),k=(n(38),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).componentDidUpdate=function(){n.node.scrollTop=n.node.scrollHeight},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"MessageList",ref:function(t){return e.node=t}},this.props.messages.map(function(e,t){return o.a.createElement(w,Object.assign({key:t},e))}))}}]),t}(a.Component));k.defaultProps={messages:[]};var y=k,j=(n(40),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).client=null,n.promptForNickname=function(e,t){e||(e="Please enter your nickname:");for(var n=prompt(e,t);!n;)n=prompt("Nickname is required:");return n},n.handleNewMessage=function(e){n.client.send(JSON.stringify({command:"new_message",body:e}))},n.state={joined:!1,nickname:null,messages:[]},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id,n=new p.c;try{this.client=n.join(t),this.client.on("open",function(){var t=e.promptForNickname();e.client.send(JSON.stringify({command:"set_nickname",nickname:t}))}),this.client.on("message",function(t){var n=JSON.parse(t);switch(n.event){case"new_message":e.setState({messages:[].concat(Object(f.a)(e.state.messages),[{timestamp:new Date(n.timestamp),me:n.author===e.state.nickname,author:n.author,body:n.body}])});break;case"nickname_taken":var a=e.promptForNickname("Nickname already taken. Please choose a new one:",n.nickname);e.client.send(JSON.stringify({command:"set_nickname",nickname:a}));break;case"room_joined":e.setState({joined:!0,nickname:n.nickname});break;default:console.log("Unsupported event: ".concat(n.event,"."))}}),this.client.on("error",function(n){n instanceof p.b&&(alert("There is no host for this room. You will become the host."),e.props.history.push("/new/".concat(t)))}),this.client.on("close",function(){e.setState({joined:!1,messages:[].concat(Object(f.a)(e.state.messages),[{timestamp:new Date,body:"Host left the room."}])})})}catch(a){this.setState({messages:[].concat(Object(f.a)(this.state.messages),[{timestamp:new Date,body:"Client received error: ".concat(a)}])})}}},{key:"render",value:function(){var e=this.props.match.params.id;return o.a.createElement(o.a.Fragment,null,o.a.createElement("h3",null,"Room: ",e," . Copy and share the URL to join."),o.a.createElement("div",{className:"Chat"},o.a.createElement(y,{messages:this.state.messages}),this.state.joined?o.a.createElement(b,{onMessageSend:this.handleNewMessage}):null))}}]),t}(a.Component)),O=Object(d.g)(j),E=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).clients={},n.host=null,n.startHosting=function(e){var t=e.match.params.id,a=new p.c;n.host=a.host(t),n.host.on("error",function(n){n instanceof p.a&&(alert("This room already has a host. You will join."),e.history.push("/room/".concat(t)))}),n.host.on("ready",function(){e.history.push("/room/".concat(n.host.hostId))}),n.host.on("connection",function(e){e.on("message",function(t){var a=JSON.parse(t);switch(a.command){case"new_message":n.broadcast(n.clients[e.remoteId],a.body);break;case"set_nickname":for(var o=a.nickname,c=!1,r=0,s=Object.keys(n.clients);r<s.length;r++){var i=s[r];if(c=n.clients[i]===o)break}c?e.send(JSON.stringify({event:"nickname_taken",timestamp:Date.now(),nickname:o})):(e.send(JSON.stringify({event:"room_joined",timestamp:Date.now(),nickname:o})),n.clients[e.remoteId]=o,n.broadcast(null,"*** ".concat(n.clients[e.remoteId]," (").concat(e.remoteId,") joined the room.")));break;default:console.log("Unsupported command: ".concat(a.command,"."))}}),e.on("close",function(){n.broadcast(null,"*** ".concat(n.clients[e.remoteId]," (").concat(e.remoteId,") left the room.")),delete n.clients[e.remoteId]})})},n.broadcast=function(e,t){n.host.broadcast(JSON.stringify({event:"new_message",timestamp:Date.now(),author:e,body:t}))},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return o.a.createElement(h.a,null,o.a.createElement("div",null,o.a.createElement(d.d,null,o.a.createElement(d.b,{exact:!0,path:"/"},o.a.createElement(d.a,{to:"/new"})),o.a.createElement(d.b,{path:"/new/:id?",render:this.startHosting}),o.a.createElement(d.b,{path:"/room/:id",component:O}))))}}]),t}(a.Component),N=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function S(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}r.a.render(o.a.createElement(E,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/chat",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/chat","/service-worker.js");N?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):S(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):S(e)})}}()}},[[27,2,1]]]);
//# sourceMappingURL=main.845f2fdf.chunk.js.map